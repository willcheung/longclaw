<!DOCTYPE html>
<!-- Start of ContextSmith Chrome extension code -->
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ContextSmith | Enterprise Account Intelligence Platform</title>

    <!-- Include style per-controller - vendor plugins -->
    <%= stylesheet_link_tag "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" %>
    <%= stylesheet_link_tag "https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" %>

    <!-- Main css styles -->
    <%= stylesheet_link_tag 'application', media: 'all' %>

    <!-- Main javascript files -->
  <%= javascript_include_tag 'application' %>
  <!-- <%= javascript_include_tag "https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js" %>-->
  <%= javascript_include_tag "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js" %>
  <%= javascript_include_tag "https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js" %>


    <%= csrf_meta_tags %>
</head>
<body>
    <!-- Wrapper-->
    <div id="wrapper" class="<%= params[:controller] %>.<%= params[:action] %>">

        <div id="page-wrapper" class="white-bg extension-sidebar">

            <!-- Navigation -->
            <div class="navbar-header border-bottom">
                <span style="width:150px; display:inline-block">
                    <a href="<%= ([User::ROLE[:Basic],User::ROLE[:Pro]].include? current_user.role) ? "http://www.contextsmith.com" : root_path %>" target="_blank" class="navbar-brand">
                        <span class="clear">
                            <div class="block logo">&nbsp;</div>
                        </span>
                    </a>
                </span>
            </div>
            <div>
                <ul class="nav nav-tabs">
                    <li role="presentation" class="<%= is_active_action('account') %>"><a href="<%= extension_account_path(internal: params[:internal], external: params[:external]) %>">People</a></li>
                    <!-- <li role="presentation" class="<%= is_active_action('contacts') %>"><a href="<%= extension_contacts_path(internal: params[:internal], external: params[:external]) %>">Contacts</a></li> -->
                    <li role="presentation" class="<%= is_active_action('salesforce') %> 
                    <% if !current_user.superadmin? %>
                    disabled"><a href="#">
                    <% else %>
                    "><a href="<%= extension_salesforce_path(internal: params[:internal], external: params[:external]) %>">
                    <% end %>
                    <img id="sfdc-icon" src="/assets/images/salesforce.png" style="width:15px;"/>&nbsp;Salesforce</a></li>
                </ul>
            </div>

            <!-- Main view  -->
            <%= yield %>
        </div>
    </div>

    <%= yield :javascript %>

    <script>
        $('[data-toggle="tooltip"]').tooltip();
        
        // $("#salesforce-entity-search").selectize({
        //     closeAfterSelect: true,
        //     valueField: 'id',
        //     labelField: 'name',
        //     searchField: ['name'],
        //     create: false,
        //     sortField: [
        //         {
        //             field: 'name',
        //             direction: 'asc'
        //         },
        //         {
        //             field: '$score'
        //         }
        //     ],
        //     render: {
        //       item: function(item, escape) {
        //         return '<div>' +
        //             (item.name ? '<span class="name">' + escape(item.name) + '</span>' : '') +
        //             (item.account ? '<span class="account">' + escape(item.account) + '</span>' : '') +
        //         '</div>';
        //       },
        //       option: function(item, escape) {
        //         var label = item.name || item.account;
        //         var caption = item.name ? item.account : null;
        //         return '<div>' +
        //             '<span class="label">' + escape(label) + '</span>' +
        //             (caption ? '<span class="caption">' + escape(caption) + '</span>' : '') +
        //         '</div>';
        //       }
        //     },
        //     load: function (term, callback) {
        //       if (!term.length) return callback()
        //       // use # to search for projects by name
        //       // console.log(callback);
        //       $.getJSON( '/search/autocomplete_salesforce_account_name.json', { term: encodeURIComponent(term) } )
        //         .done( function (data) {
        //           // console.log(data);
        //           callback(data);
        //         })
        //         .fail( function () {
        //           console.log("fail");
        //           callback();
        //         })
              
        //     },
        //     onDropdownOpen: function ($dropdown) {
        //       // Manually prevent dropdown from opening when:
        //       // 1. There is no search term, or
        //       // 2. The search term does not begin with #
        //       // 3. At least one project has been selected already
        //       if (!this.lastQuery.length || this.items.length) {
        //         this.close();
        //       }
        //     },
        //     onBlur: function () {
        //       // Manually prevent input box from being cleared on blur
        //       this.setTextboxValue(this.lastQuery);
        //     }
        // });

<% if @enable_sfdc_refresh %>
        // $('.sfdc-refresh').click(function(){
        //     var entity_type;
        //     var buttonTxtStr = self.attr("btnLabel");
        //     var self = $(this);
        //     if ($(this).attr("id").includes("salesforce-ext-acc-refresh")) {  //clicked on 'Refresh Accounts'
        //         entity_type = "account";
        //         requestURL = "/salesforce/import/account";
        //     }
        //     // else if ($(this).attr("id").includes("salesforce-opp-refresh")) {
        //     //     entity_type = "project";
        //     //     requestURL = "/salesforce/import/project";
        //     // }
        //     else if ($(this).attr("id").includes("salesforce-ext-cont-import")) {  //clicked on 'Import Contacts'
        //         entity_type = "contact";
        //         requestURL = "/salesforce/sync";
        //     }
        //     else {
        //         return;
        //     }

        //     $.ajax(requestURL, {
        //         async: true,
        //         method: "POST",
        //         data: { "entity_type": entity_type },
        //         beforeSend: function () {
        //             self.css("pointer-events", "none");
        //             $("#" + self.attr("id") + " .fa.fa-refresh").addClass('fa-spin');
        //         },
        //         error: function(data) {
        //             var res = JSON.parse(data.responseText);
        //             self.addClass('error-btn-highlight');
        //             alert("Encountered " + buttonTxtStr + " error!\n\n" + res.error);
        //         },
        //         statusCode: {
        //             500: function() {
        //                 //self.css("margin-left","0px");
        //                 self.html("<i class='fa fa-exclamation'></i> Salesforce query error");
        //             },
        //             503: function() {
        //                 //self.css("margin-left","0px");
        //                 self.html("<i class='fa fa-exclamation'></i> Salesforce connection error");
        //             },
        //         },
        //         complete: function() {
        //             self.css("pointer-events", "auto");
        //             $("#" + self.attr("id") + " .fa.fa-refresh").removeClass('fa-spin');
        //             location.reload();
        //         }
        //     });
        // });
<% end %>

        // // Button to show the form to link SFDC account
        // function show_link_account_form_btn_clicked () {
        //     $("#show-link-account-form-btn").hide();
        //     $("#search-form-div").show();
        // }

        // // Disable the "Link" submit button after clicking it
        // $("#search-form").submit(function () {
        //     $("#search-form .btn").attr("disabled", true);
        //     return true;
        // });
    </script>

    <%= javascript_include_tag "https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js" %>
    <%= javascript_include_tag "https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js" %>

    <% if ENV["RAILS_ENV"] == 'production' %>
    <!-- Google Analytics -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', '<%= ENV['GA_ID'] %>', 'auto');
          ga('send', 'pageview');
        </script>
    <% end %>

    <!-- TODO: Remove this hardcoded CSS workaround -->
    <style>
        .nav {
            padding-bottom: 1px;
        }
        .nav-tabs > li.active > a, .nav-tabs > li.active > a:hover, .nav-tabs > li.active > a:focus 
        {
            color: #3C8DC5;
            border: none;
            border-bottom: 2px solid #3C8DC5;
            pointer-events: none;
        }
        .nav-tabs > li > a:hover, .nav-tabs > li > a:focus {
            color: #7cb5ec;
            background-color: transparent;
            border: none;
            border-bottom: 2px solid #7cb5ec;
        }
        .nav-tabs > li > a {
            color: #676a6c;
            border: none;
            border-bottom: 2px solid white;
        }
        .nav-tabs > li.inactive > a {
            /*border-bottom: 2px solid white;*/
        }
        /*.dropdown-menu {
            border: 1px solid #aaa;
            z-index: 2003;
        }*/
        .selectize-input {
            height: 1.75em;
            display: inline-block;
            padding-top: 0em;
            overflow: auto;
        }
        .selectize-input input, .selectize-input span {
            padding-top: 0em;
            font-size: 10px;
            //text-overflow: ellipsis;
        }
        .selectize-control.multi .selectize-input.has-items {
            padding-top: 0em;
        }
        .selectize-control.multi .selectize-input.has-items div {
            padding-top: 0em;
            padding-bottom: 0em;
        }
        .disabled, .btn:disabled {
            color: #DDD;
            opacity: 0.3;
            pointer-events: none;
        }
    </style>
</body>
</html>
<!-- End of ContextSmith Chrome extension code -->
