<div class="vertical-timeline-block <%= a.id.to_s + a.category %>" id="<%= a.backend_id.to_s %>">

    <% if a.category == Activity::CATEGORY[:Conversation] %>
        <div class="vertical-timeline-icon secondary-bg">
            <i class="fa fa-envelope"></i>
        </div>
    <% elsif a.category == Activity::CATEGORY[:Note] %>
        <div class="vertical-timeline-icon sticky-bg">
            <i class="fa fa-sticky-note"></i>
        </div>
    <% elsif a.category == Activity::CATEGORY[:Meeting] %>
        <div class="vertical-timeline-icon warning-bg">
            <i class="fa fa-calendar"></i>
        </div>
    <% elsif a.category == Activity::CATEGORY[:JIRA] %>
        <div class="vertical-timeline-icon jira-bg">
            <i class="jira-logo"></i>
        </div>
    <% elsif a.category == Activity::CATEGORY[:Zendesk] %>
        <div class="vertical-timeline-icon zd-bg">
            <i class="zd-logo"></i>
        </div>
    <% elsif a.category == Activity::CATEGORY[:Salesforce] %>
        <div class="vertical-timeline-icon salesforce-bg">
            <i class="salesforce-logo"></i>
        </div>
    <% end %>

    <!-- <span class="vertical-date left"><%= Time.zone.at(a.last_sent_date).strftime("%b %d") %><br />
        <small><%= Time.zone.at(a.last_sent_date).strftime("%l:%M%P") %></small>
    </span> -->

    <div class="" <% if a.category == Activity::CATEGORY[:Note] %> style="background-color: #fff7db" <% end %> >
        <% if a.category == Activity::CATEGORY[:Conversation] %>
            <h4 class="in-bl"><strong><%= truncate(a.title, length: 25, separator: ' ') %></strong> (<%= a.email_messages.size %>)</h4>
            <small class="pull-right"><%= get_conversation_member_names(a.from, a.to, a.cc, 'other', 2) %></small>

            <div class="chat-discussion">
                <% m = a.email_messages.last %>
                <div class="">
                    <span class="message-content">
                        <%# smart_email_body(m, @users_reverse.present?) %>
                        <%= if m.content.nil? || m.content.is_a?(String)
                          truncate(m.content, length: 70, separator: ' ')
                        else
                          truncate(m.content.body, length: 70, separator: ' ')
                        end %>
                    </span>
                </div>
                <p class="text-muted">7 days ago by Will Cheung</p>
            </div> <!-- chat discussion -->

        <% elsif a.category == Activity::CATEGORY[:Note] %>
            <div class="chat-discussion rag-bar<%=a['rag_score']%>">
                <p class="m-b-xs"><strong><%= get_full_name(a.user) %></strong> wrote:</p>
                <%= truncate(a.note, length: 70, separator: ' ') %>
            </div>

        <% elsif a.category == Activity::CATEGORY[:Meeting] %>
            <h3><%= a.title %>
                <small class="m-l-md"><%= get_calendar_interval(a) %></small>
                <span id="private" <% if a.is_public %>style="display:none;"<% end %>><i class="fa fa-lock pull-right" title="Private"></i></span>
                <span id="pinned" <% if !a.is_pinned %>style="display:none;"<% end %>><i class="fa fa-thumb-tack pull-right" title="Pinned"></i></span>
            </h3>

            <div class="chat-discussion">
                <div class="row">
                    <div class="col-lg-3"><strong>Meeting Organizer:</strong> <%= a.from[0].personal ? a.from[0].personal : a.from[0].address %></div>
                    <div class="col-lg-9"><strong>Attendees:</strong> <%= get_calendar_member_names(a.to) %></div>
                </div>
            </div> <!-- chat discussion -->

        <% elsif a.category == Activity::CATEGORY[:Salesforce] %>
            <h3><%= a.title %>
                <small class="m-l-md"><%= a.from[0].personal ? a.from[0].personal : a.from[0].address %></small>
                <span class="label pull-right">Task</span>
                <span id="private" <% if a.is_public %>style="display:none;"<% end %>><i class="fa fa-lock pull-right" title="Private"></i></span>
                <span id="pinned" <% if !a.is_pinned %>style="display:none;"<% end %>><i class="fa fa-thumb-tack pull-right" title="Pinned"></i></span>
            </h3>

            <div class="chat-discussion">
                <div class="row">
                    <div class="col-xs-11">
                        <%= simple_format(a.note) %>
                    </div>
                </div>
            </div> <!-- chat discussion -->

        <% elsif a.category == Activity::CATEGORY[:JIRA] %>
            <h3>
                <%= a.title %>
                <small class="m-l-md"><%= get_conversation_member_names(a.from, a.to, a.cc) %></small>
                <span class="label pull-right"><%= a.email_messages.first.issue.fields.status.name %></span>
                <span id="private" <% if a.is_public %>style="display:none;"<% end %>><i class="fa fa-lock pull-right" title="Private"></i></span>
                <span id="pinned" <% if !a.is_pinned %>style="display:none;"<% end %>><i class="fa fa-thumb-tack pull-right" title="Pinned"></i></span>
            </h3>

            <div class="chat-discussion">
                <div><strong>Description:</strong> <%= a.note %></div>
                <% if a.email_messages.first.issue.fields.comment.total > 1 %>
                    <div class="more-messages">
                        <a class="show-more-<%= a.id.to_s %>"><i class="fa fa-plus-square"></i> &nbsp; <%= pluralize(a.email_messages.first.issue.fields.comment.total - 1, 'older comment') %> on JIRA</a>
                    </div>
                <% end %>

                <% a.email_messages.first.issue.fields.comment.comments.each_with_index do |c, i| %>
                    <div class="hidden-message-filter hidden-chat-message-<%= a.id.to_s %>" <% unless a.email_messages.first.issue.fields.comment.total - 1 == i %> style="display:none;" <% end %> >
                        <div class="chat-message left">
                            <%= get_profile_pic(c.author.displayName, c.author.emailAddress, "message-avatar") %>
                            <div class="message">
                                <span class="message-author" href="#"> <%=c.author.displayName %> </span> added a comment - <%= time_ago_in_words(c.updated.to_time) %> ago
                                <span class="message-content"><%= simple_format(c.body) %></span>
                            </div>
                        </div>
                    </div>
                <% end %>
            </div>

        <% elsif a.category == Activity::CATEGORY[:Zendesk] %>
            <h3>
                <%= a.title %>
                <small class="m-l-md"><%= get_conversation_member_names(a.from, a.to, a.cc) %></small>
                <span class="label pull-right"><%= a.email_messages.first.status %></span>
                <span id="private" <% if a.is_public %>style="display:none;"<% end %>><i class="fa fa-lock pull-right" title="Private"></i></span>
                <span id="pinned" <% if !a.is_pinned %>style="display:none;"<% end %>><i class="fa fa-thumb-tack pull-right" title="Pinned"></i></span>
           </h3>

            <div class="chat-discussion">
                <% if a.email_messages.first.comments.length > 1 %>
                    <div class="more-messages">
                        <a class="show-more-<%= a.id.to_s %>"><i class="fa fa-plus-square"></i> &nbsp; <%= pluralize(a.email_messages.first.comments.length - 1, 'older comment') %> on Zendesk</a>
                    </div>
                <% end %>

                <% a.email_messages.first.comments.each_with_index do |c, i| %>
                    <div class="hidden-message-filter hidden-chat-message-<%= a.id.to_s %>" <% unless a.email_messages.first.comments.length - 1 == i %> style="display:none;" <% end %> >
                        <div class="chat-message left">
                            <%= get_profile_pic(c.author, c.author, "message-avatar") %>
                            <div class="message">
                                <span class="message-author" href="#"> <%= c.author %> </span> added a comment - <%= c.created_at %>
                                <span class="message-content"><%= simple_format(c.text) %></span>
                            </div>
                        </div>
                    </div>
                <% end %>
            </div>
        <% end %>

        <div class="content-footer footer-<%= a.id %>">
        <!-- TODO: add days ago and last ping by here -->
        </div>

    </div>
</div>

<%= render 'activities/show_more_js', :a => a %>
