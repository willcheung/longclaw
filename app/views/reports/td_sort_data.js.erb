var chart = $('#left-chart').highcharts();
chart.xAxis[0].setCategories(<%= @data.map(&:name).to_json.html_safe %>, false);
while(chart.series.length > 1) {
  chart.series[1].remove();
}
<% if @metric == ReportsController::TEAM_DASHBOARD_METRIC[:activities_last14d] %>
  chart.series[0].hide();
  <% @categories.each.with_index do |c, i| %>
  chart.addSeries({
    name: "<%= c %>",
    color: "<%= highcharts_series_color(c) %>",
    data: [ 
    <% @data.each do |d| %>
    {
      y: <%= d.y[i].num_activities %>,
      id: "<%= d.id %>"
    }, 
    <% end %> 
    ]
  }, false)
  <% end %>
<% elsif @metric == ReportsController::TEAM_DASHBOARD_METRIC[:time_spent_last14d] %>
  chart.series[0].hide();
  <% @categories.each do |c| %>
  chart.addSeries({
    name: "<%= c %>",
    color: "<%= highcharts_series_color(c) %>",
    data: [ 
    <% @data.each do |d| %>
    {
      y: <%= d.y[c] %>,
      id: "<%= d.id %>"
    }, 
    <% end %> 
    ]
  }, false)
  <% end %>
<% else %>
  chart.series[0].show();
  chart.series[0].update({
    name: "<%= @metric.html_safe %>",
    color: "<%= highcharts_series_color("Default") %>",
    data: [ <% @data.each do |d| %>
    {
      y: <%= d.y %>,
      id: "<%= d.id %>"
    },
    <% end %> ]
  }, false);
<% end %>

chart.yAxis[0].update( { tickInterval: <%= @metric_tick_interval %> });
//console.log("datamax=" + chart.yAxis[0].dataMax);
chart.setSize(undefined, 50 + Math.min(1150, <%= @data.size %> * 110));
chart.redraw();