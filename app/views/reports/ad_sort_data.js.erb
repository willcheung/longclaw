var barColors = { 
  blue: '#7cb5ec', 
  highRisk: '#ed5565',
  mediumRisk: '#FFA500',
  lowRisk: '#A1C436'
};
var chart = $('#left-chart').highcharts();
chart.xAxis[0].setCategories(<%= @data.map(&:name).to_json.html_safe %>, false);
chart.series[0].update({ 
  name: "<%= @metric.html_safe %>",
  data: [ <% @data.each do |d| %>
  {
    y: <%= d.y %>,
    color: barColors["<%= d.color %>"],
    id: "<%= d.id %>"
  },
  <% end %> ]
}, false);

<% if @metric == "Negative Sentiment Score" || @metric == "Risk Score" %>
chart.yAxis[0].update({min: 0, max: 100}, false);
// set average line and unhide
chart.series[1].setData(<%= Array.new(@data.length, @average).to_json.html_safe %>)
chart.series[1].show();
<% else %>
chart.yAxis[0].update({min: undefined, max: undefined}, false);
chart.series[1].hide();  // hide average line
<% end %>

chart.yAxis[0].update( { tickInterval: <%= @metric_tick_interval %> });
chart.setSize(undefined, 50 + Math.min(1150, <%= @data.size %> * 110));
chart.redraw();